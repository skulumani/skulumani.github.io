---
layout: post
title: "Starting with GPG and YubiKey"
date: 2019-01-19
tags: [gpg,]
excerpt: "A short introduction to public-key cryptography and GPG."
---

## What is public-key cryptography?

[There](https://github.com/bfrg/gpg-guide) are [many](https://www.gnupg.org/gph/en/manual.html) [guides](https://en.wikibooks.org/wiki/Cryptography/Public_Key_Overview) available online which describe the basics of public-key cryptography.
This post will not focus on the basics but rather a specific implementation of using GPG with a [YubiKey](https://www.yubico.com/).
With this approach you'll have your GPG secrets in a portable and secure device which you can then use on any machine.

In short, public-key cryptography is aimed at allowing two parties to securely generate a secret, a secure key, through an insecure communication channel.
In essence, two parties will share some public information, completely in the clear for anyone to see/record, yet they will still arrive at the same secret key!
With this secret key, both parties can then encrypt data and securely pass it between themselves. 

One key assumption with public-key cryptography is that the private portions of this key actually remains secret. 
Due to this, the Yubikey provides an excellent solution.
The Yubikey hardware token provides a secure hardware solution to store OpenPGP keys, and act as a second factor device for many web services. 
With the Yubikey, and GPG, you can securely use your private GPG keys with the knowledge that it is techinically infeasible to remove them from the device.

## Requirements

In order to follow this you'll want the following:

1. A YubiKey 4 or better which supports 4096 bit RSA keys. Ideally buy two of them to have a backup.
2. Two USB keys to create a secure OS and backup your GPG keys
3. Some time and patience. You'll probably run into problems and will have to debug.

This will basically follow the guide by [drduh](https://github.com/drduh/YubiKey-Guide) with some additional details where I ran into issues.

## Creating your GPG keys securely

One of the main benefits of using a Yubikey is that you can be certain that your private keys are actually secure. 
If you generate all of these "secret" keys on a public or compromised system then none of this stuff really matters. 
For this reason, it makes the most sense to do the following on a secure system, such as [Tails OS](https://tails.boum.org/index.en.html).

Follow the instructions and create a secure Tails OS.
You'll essentially download Tails, create a live USB, then boot to this version and create a really secure version of Tails on your second USB drive. 

Once you have Tails setup, boot into it and install the following software

~~~
sudo apt-get update
sudo apt-get install -y \
    curl gnupg2 gnupg-agent \
    cryptsetup scdaemon pcscd \
    yubikey-personalization \
    dirmngr \
    secure-delete \
    hopenpgp-tools
~~~

## Additional information

* [Operational PGP](https://gist.github.com/grugq/03167bed45e774551155)
* [Yubikey 4 guide](https://blog.liw.fi/posts/2017/05/29/using_a_yubikey_4_for_ensafening_one_s_encryption/)
* [Yubikey guide](https://ttmm.io/tech/yubikey/)
* [Quick Start GPG](https://github.com/bfrg/gpg-guide)
* [Yubikey Guide](https://github.com/drduh/YubiKey-Guide)
